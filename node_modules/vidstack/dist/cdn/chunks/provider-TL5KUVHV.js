import { b } from './chunk-UIEMEEF3.js';
import { a } from './chunk-P2F2OUSM.js';
import { s, t as t$1, v as v$2, q as q$1 } from './chunk-VO3OMEJR.js';
import { h } from './chunk-URNGIKP5.js';
import './chunk-TZY7Y2Z6.js';
import { x, v as v$3, o, m } from './chunk-SEVK3JXX.js';
import { j as j$1, t, A as A$1, c, p, v as v$1 } from './chunk-OJDYYIWI.js';

async function j(r,{player:e,delegate:t$1,logger:o}){let c={onLoadStart(){x(e,"hls-lib-load-start");},onLoaded(a){x(e,"hls-lib-loaded",{detail:a});},onLoadError(a){let d=q$1(a);x(e,"hls-lib-load-error",{detail:d}),t$1.dispatch("error",{detail:{message:d.message,code:4}});}},p$1=await A(r,c);if(p(p$1)&&!t(r)&&(p$1=await N(r,c)),!p$1)return null;if(!p$1.isSupported()){let a="[vidstack]: `hls.js` is not supported in this environment";return x(e,"hls-unsupported"),t$1.dispatch("error",{detail:{message:a,code:4}}),null}return p$1}async function N(r,e={}){if(!p(r)){if(e.onLoadStart?.(),r.prototype&&r.prototype!==Function)return e.onLoaded?.(r),r;try{let t=(await r())?.default;if(t&&!!t.isSupported)e.onLoaded?.(t);else throw Error("");return t}catch(t){e.onLoadError?.(t);}}}async function A(r,e={}){if(!!t(r)){e.onLoadStart?.();try{if(await t$1(r),!v$1(window.Hls))throw Error("");let t=window.Hls;return e.onLoaded?.(t),t}catch(t){e.onLoadError?.(t);}}}var U=r=>m(r),W=r=>o(r);function I(r,e,t,o,{player:c$1,logger:p,delegate:a$1,$store:d},T){let g=new Set;A$1(()=>{let s=t();if(!s)return;let n=c(()=>d.streamType).includes("ll-"),i=new s({lowLatencyMode:n,...e});A$1(()=>void O(i,c$1[v$2]())),i.on(s.Events.ERROR,G),o.set(i);for(let f of T)f(i);x(c$1,"hls-instance",{detail:i}),i.attachMedia(r.media);let h=c(t).Events.LEVEL_LOADED;return i.on(h,F),a$1.dispatch("provider-setup",{detail:r}),()=>{g.clear(),i.destroy(),o.set(null);}}),A$1(()=>{if(!d.live)return;let s=o();if(!s)return;let n=a(()=>{d.liveSyncPosition=s.liveSyncPosition??1/0;});return n.start(),n.stop});function x$1(s,n){c$1.dispatchEvent(new v$3(U(s),{detail:n}));}function O(s,n){for(let i of n)g.has(i)||(s.on(W(i),x$1),g.add(i));}function F(s,n){if(d.canPlay)return;let{type:i,live:h,totalduration:f}=n.details,H=new v$3(s,{detail:n});a$1.dispatch("stream-type-change",{detail:h?i==="EVENT"&&Number.isFinite(f)?"live:dvr":"live":"on-demand",trigger:H}),a$1.dispatch("duration-change",{detail:f,trigger:H}),o().media.dispatchEvent(new v$3("canplay",{trigger:H}));}function G(s,n){if(n.fatal)switch(n.type){case"networkError":o()?.startLoad();break;case"mediaError":o()?.recoverMediaError();break;default:o()?.destroy(),o.set(null);break}}}var J=Symbol(0),K="https://cdn.jsdelivr.net",q,v=class extends b{constructor(){super(...arguments);this[q]=!0;this.F=j$1(null);this.A=j$1(null);this.K=new Set;this.T=`${K}/npm/hls.js@^1.0.0/dist/hls.min.js`;this.config={};}get type(){return "hls"}get canLiveSync(){return !0}get library(){return this.T}set library(t){this.T=t;}preconnect(){!t(this.T)||s(this.T);}setup(t){super.setup(t),j(this.T,t).then(o=>this.F.set(()=>o)),I(this,this.config,this.F,this.A,t,this.K);}get ctor(){return this.F()}get instance(){return this.A()}async loadSource({src:t$1}){A$1(()=>{if(!t(t$1))return;this.A()?.loadSource(t$1);});}onInstance(t){let o=c(this.A);return o&&t(o),this.K.add(t),()=>this.K.delete(t)}};q=J,v.supported=h();

export { v as HLSProvider, J as HLS_PROVIDER };
