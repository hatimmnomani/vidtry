import { p, e, o, b } from './chunk-URNGIKP5.js';
import { f, O, E, x } from './chunk-SEVK3JXX.js';
import { t, p as p$1, s, h, q } from './chunk-OJDYYIWI.js';

function D(e){let i;function r(){!p$1(i)||n();}function n(){i=window.requestAnimationFrame(function(){p$1(i)||(e(),n());});}function h(){s(i)&&window.cancelAnimationFrame(i),i=void 0;}return {start:r,stop:h}}function A(e$1,{player:i,$store:r,delegate:n,logger:h$1}){let u=O(),s=!1,g=!1,y=!1,d=D(()=>{let t=e$1.currentTime;r.currentTime!==t&&m(t);});x$1(),h(()=>{d.stop(),u.empty();});function a(t,o){return E(e$1.media,t,o)}function x$1(){a("loadstart",H),a("abort",E$1),a("emptied",N),a("error",nt);}function R(){g||(u.add(a("loadeddata",O$1),a("loadedmetadata",j),a("canplay",V),a("canplaythrough",W),a("durationchange",K),a("play",I),a("progress",Z),a("stalled",G),a("suspend",tt)),g=!0);}function F(){y||(u.add(a("pause",U),a("playing",B),a("ratechange",et),a("seeked",X),a("seeking",Y),a("ended",J),a("volumechange",Q),a("waiting",z)),y=!0);}function m(t,o){n.dispatch("time-update",{detail:{currentTime:Math.min(t,r.seekableEnd),played:e$1.media.played},trigger:o});}function E$1(t){n.dispatch("abort",{trigger:t});}function H(t){if(e$1.media.networkState===3){E$1(t);return}R(),n.dispatch("load-start",{trigger:t});}function N(t){n.dispatch("emptied",{trigger:t});}function O$1(t){n.dispatch("loaded-data",{trigger:t});}function j(t){q$1(),F(),n.dispatch("volume-change",{detail:{volume:e$1.media.volume,muted:e$1.media.muted}}),n.dispatch("loaded-metadata",{trigger:t}),e&&o(r.source)&&n.ready(c(),t);}function c(){return {duration:e$1.media.duration,buffered:e$1.media.buffered,seekable:e$1.media.seekable}}function q$1(){if(r.streamType!=="unknown")return;let t=!Number.isFinite(e$1.media.duration);n.dispatch("stream-type-change",{detail:t?"live":"on-demand"});}function I(t){n.dispatch("play",{trigger:t});}function U(t){e$1.media.readyState===1&&!s||(s=!1,d.stop(),n.dispatch("pause",{trigger:t}));}function V(t){n.ready(c(),t);}function W(t){r.started||n.dispatch("can-play-through",{trigger:t,detail:c()});}function B(t){s=!1,n.dispatch("playing",{trigger:t}),d.start();}function G(t){n.dispatch("stalled",{trigger:t}),e$1.media.readyState<3&&(s=!0,n.dispatch("waiting",{trigger:t}));}function z(t){e$1.media.readyState<3&&(s=!0,n.dispatch("waiting",{trigger:t}));}function J(t){d.stop(),m(e$1.media.duration,t),n.dispatch("end",{trigger:t}),r.loop?$():n.dispatch("ended",{trigger:t});}function K(t){r.ended&&m(e$1.media.duration,t),n.dispatch("duration-change",{detail:e$1.media.duration,trigger:t});}function Q(t){n.dispatch("volume-change",{detail:{volume:e$1.media.volume,muted:e$1.media.muted},trigger:t});}function X(t){n.dispatch("seeked",{detail:e$1.media.currentTime,trigger:t}),Math.trunc(e$1.media.currentTime)===Math.trunc(e$1.media.duration)&&b(e$1.media.duration)>b(e$1.media.currentTime)&&(m(e$1.media.duration,t),e$1.media.ended||x(i,"media-play-request",{trigger:t}));}function Y(t){n.dispatch("seeking",{detail:e$1.media.currentTime,trigger:t});}function Z(t){n.dispatch("progress",{detail:{buffered:e$1.media.buffered,seekable:e$1.media.seekable},trigger:t});}function $(){q(e$1.media.controls)&&(e$1.media.controls=!1),x(i,"media-loop-request");}function tt(t){n.dispatch("suspend",{trigger:t});}function et(t){}function nt(t){let o=e$1.media.error;!o||n.dispatch("error",{detail:{message:o.message,code:o.code,mediaError:o},trigger:t});}}var _=class{constructor(i){this.E=i;}setup(i){A(this,i);}get type(){return ""}get media(){return this.E}get paused(){return this.E.paused}get muted(){return this.E.muted}set muted(i){this.E.muted=i;}get volume(){return this.E.volume}set volume(i){this.E.volume=i;}get currentTime(){return this.E.currentTime}set currentTime(i){this.E.currentTime=i;}get playsinline(){return this.E.hasAttribute("playsinline")}set playsinline(i){f(this.E,"playsinline",i);}async play(){return this.E.play()}async pause(){return this.E.pause()}async loadSource({src:i},r){this.E.preload=r,p(i)?this.E.srcObject=i:(this.E.srcObject=null,this.E.src=t(i)?i:window.URL.createObjectURL(i)),this.E.load();}};

export { D as a, _ as b };
